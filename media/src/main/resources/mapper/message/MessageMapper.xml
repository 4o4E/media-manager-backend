<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.e404.media.module.media.mapper.MessageMapper">

    <resultMap id="BaseResultMap" type="top.e404.media.module.media.entity.MessageDo">
        <constructor>
            <idArg name="id" column="id" jdbcType="BIGINT"/>

            <arg name="content" column="content" jdbcType="JSON"/>
            <arg name="type" column="type" jdbcType="TINYINT"/>
            <arg name="hash" column="hash" jdbcType="VARCHAR"/>
            <arg name="approved" column="approved" jdbcType="TINYINT"/>

            <arg name="version" column="version" jdbcType="BIGINT"/>
            <arg name="createBy" column="create_by" jdbcType="BIGINT"/>
            <arg name="createTime" column="create_time" jdbcType="TIMESTAMP"/>
            <arg name="updateBy" column="update_by" jdbcType="BIGINT"/>
            <arg name="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
        </constructor>
    </resultMap>

    <select id="query" resultType="top.e404.media.module.media.entity.MessageDo">
        SELECT * FROM media_message m
                 LEFT JOIN media_message_tag mt ON m.id = mt.message_id
        WHERE true
        <if test="queryMode == top.e404.media.module.media.entity.QueryMode.ALL">
            (<foreach collection="tags" separator=" OR " item="tagId">
                mt.id = #{tagId}
            </foreach>)
        </if>
    </select>

</mapper>
